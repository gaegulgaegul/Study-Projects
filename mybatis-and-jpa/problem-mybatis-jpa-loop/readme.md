### JPA & Mybatis 차이점에 의한 서비스(로직) 문제

- 회사에서 JPA & Mybatis를 혼용한 프로젝트 진행 중 발생한 문제를 재현하였다.
- 문제점
    - Mybatis에서 새로운 id 값을 읽어 JPA를 통해 저장하도록 로직을 구현
    - for문을 돌면서 새 id를 조회하고 바로 JPA를 통해 저장하도록 하였다.
    - 기대한대로 쿼리가 실행되지 않았다.
    - id는 처음 조회한 값 그대로다.
    - hibernate에서 더티 체킹이 되어 처음 조회한 id를 계속 사용하고, 해당 id에 저장된 데이터만 update하고 있다.
- 원인
    - JPA의 엔티티 상태와 Mybatis의 계층이 서로 다르기 떄문에 발생하는 오류
    - persist 상태의 엔티티 데이터는 persist context에 저장(1차 캐싱)되고 해당 로직의 트랜잭션이 끝나지 않았기 떄문에 Mybatis를 통해 id를 조회해도 계속 같은 값만 조회된다.
    - 업무에서는 자바로직에서 id를 새로 발급하는 로직으로 대체했지만 현재 상황으로는 해결방안은 없다(내가 부족해서 찾지 못했다...)